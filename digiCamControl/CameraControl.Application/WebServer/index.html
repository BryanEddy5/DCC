<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link type="text/css" rel="stylesheet" href="//internal-cdn.amazon.com/oneg.amazon.com/assets/3.2.5/css/application.min.css" />

    <script type="text/javascript" src="https://internal-cdn.amazon.com/btk.amazon.com/ajax/libs/jquery/2.1.4/jquery-2.1.4.js"></script>

    <style type="text/css">
      .goodState   {color: green;}
      .badState    {color: red;}
      ul           {list-style: none;}
      ul li:before {content: "\00BB \0020";}
    </style>

    <script>
    var baseUrl = "";

    $(document).ready(function(){
        function jsonpGetStatus() {
            clearStatus();
            var sessionAPI = baseUrl + "jsonp.api?jsoncallback=?";

            $.ajax({
                dataType: "json",
                url: sessionAPI,
                data: {
                    operation: "status",
                    format: "json"
                },
                timeout: 2000 // wait 2 seconds
            }).fail(function( jqxhr, textStatus, error ) {
                var msg = "Request Failed (" + textStatus + ")!"
                if (textStatus === "timeout") {
                    msg = msg + " Make sure DCC is running."
                }
                $('#SoftwareVersionId').text("Unknown");
                $('#AjaxStatusId').text(msg);
            }).done(function (jsonResult) {
                var softwareVersion = jsonResult["version"];
                $('#SoftwareVersionId').text(softwareVersion);

                var cameraSerialNumber =  jsonResult["cameraSerialNumber"];
                var msg;
                if (cameraSerialNumber) {
                    msg = "Connected and on!"
                    addRemoveClass("AjaxStatusId", "goodState", "badState");
                }
                else {
                    msg = "Disconnected or off!"
                }
                $('#AjaxStatusId').text(msg);

                var postData = {
                    cameraName: jsonResult["cameraName"],
                    cameraSerialNumber: cameraSerialNumber,
                    cameraSettings: jsonResult["cameraSettings"]
                };

                var postDataStringified = JSON.stringify(postData, undefined, 4);
                $('#StatusDataId').text(postDataStringified);
            });
        }

        function clearStatus() {
            $('#StatusDataId').text("");
            $('#SoftwareVerionId').text("");
            $('#AjaxStatusId').text("");
            addRemoveClass("AjaxStatusId", "badState", "goodState"); // assume the worst
        }

        function addRemoveClass(elemId, addClass, removeClass) {
           $('#' + elemId).addClass(addClass).removeClass(removeClass);
        }

        $("#getStatusButton").click(jsonpGetStatus);
        $("#clearButton").click(clearStatus);

        jsonpGetStatus(); // initial state
    });
    </script>

    <title>WebCat Startup</title>
  </head>
<body>
  <div class="container-fluid">
    <div id="navbar" class="well row">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://photoretakes.corp.amazon.com/badge-operations">Badge Printing Operations</a>
      </div>
    </div>
    <h3>Welcome to the WebCat Startup Page</h3>
    <p>
      <ul>
        <li>
          Visit
          <b><a href="https://photoretakes.corp.amazon.com/badge-operations">Badge Printing Operations</a></b>
          to begin taking photos!
        </li>
      </ul>
    </p>
    <p></p>
    <p>
      Software Version: <b><span id="SoftwareVersionId"></span></b>
      <br/>
      Camera Status: <b><span class="goodState" id="AjaxStatusId"></span></b>
    </p>
    <div>
      <pre  id="StatusDataId">
      </pre>
    </div>
    <div>
      <button class="btn" id="getStatusButton">Update Status</button>
    </div>
  </div>
</body>
</html>
